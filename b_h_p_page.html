<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript" src="./js/jquery-1.7.1.js"></script>
<script type="text/javascript" src="./js/error_image.js"></script>
<script type="text/javascript" src="./js/checkmark_image.js"></script>
<link rel="stylesheet" href="./css/b_h_p_page.css" />
</head>
<body>

<div class="b_all">
<!-- 	左上角文字 -->
	<div class="left_top_text">
		您知道BPH患者发生下列情况的概率是多少吗？
	</div>
	<!--  右上角图片 -->
	<div class="b_right_top">
		<div class="left">
			<img alt="" src="./image/L0/L0-2.png">
		</div>
		<div class="right">
			<img alt="" src="./image/L0/L0-1.png">
		</div>
	</div>
	
<!-- 	前列腺体积变大 -->
	<div class="b_prostate_volume_was_larger">
		<div id="image1">
			<img alt="" src="./image/L2/L2-6.png">
		</div>
		<div id="image2">
			<img alt="" src="./image/L2/L2-11.png">
		</div>
		<div id="t">
			前列腺体积变大
		</div>
	</div>
	
	<!-- 	需要接受外科手术治疗  -->
	<div class="b_surgical_treatment">
		<div id="image1">
			<img alt="" src="./image/L2/L2-6.png">
		</div>
		<div id="image2">
			<img alt="" src="./image/L2/L2-11.png">
		</div>
		<div id="image_canvas">
			<canvas id="red_line_canvas" width="419" height="121" ></canvas>
<!-- 			<canvas id="red_line_canvas" width="58" height="30" ></canvas> -->
		</div>
		<div id="image3">
			<img alt="" src="./image/L2/L2-3.png">
		</div>
		<div id="image4">
			<img alt="" src="./image/L2/L2-12.png">
		</div>
		<div id="image5">
			<img alt="" src="./image/L2/L2-12.png">
		</div>
		<div id="image6">
			<img alt="" src="./image/L2/L2-12.png">
		</div>
		
		<div id="t">
			需要接受外科手术治疗
		</div>
	</div>
<!-- 	发生急性尿储留	 -->
	<div class="b_acute_urinary_retention">
		<div id="image2">
			<img alt="" src="./image/L2/L2-13.png">
		</div>
		<div id="image3">
			<img alt="" src="./image/L2/L2-7.png">
		</div>
		<div id="image1">
			<img alt="" src="./image/L2/L2-14.png">
		</div>
		<div id="t">
			发生急性尿储留
		</div>
	</div>
	
<!-- 	发生急性尿储留或需要接受BPH相关手术 -->
	<div class="b_bhp_related_to_surgery">
		
		<div id="image2">
			<img alt="" src="./image/L2/L2-13.png">
		</div>
		<div id="image3">
			<img alt="" src="./image/L2/L2-7.png">
		</div>
		<div id="image1">
			<img alt="" src="./image/L2/L2-14.png">
		</div>
		<div id="image4">
			<img alt="" src="./image/L2/L2-3.png">
		</div>
		<div id="image5">
			<img alt="" src="./image/L2/L2-12.png">
		</div>
		<div id="image6">
			<img alt="" src="./image/L2/L2-12.png">
		</div>
		<div id="image7">
			<img alt="" src="./image/L2/L2-12.png">
		</div>
		<div id="t">
			发生急性尿储留或需要接受BPH相关手术
		</div>
	</div>
<!-- 中间显示器 -->
	<div class="b_monitor">
		<div id="image_div1">
			<img alt="" src="./image/L2/L2-2.png">
		</div>
		<div id="image_div2">
			<img alt="" src="./image/L2/L2-4.png">
		</div>
		<div id="image_div3">
			BPH
		</div>
		<div id="image_div4">
			<canvas id="line_canvas"></canvas>
		</div>

		<div id="left_top">
			<img alt="" src="./image/L2/L2-5.png">
		</div>
		<div id="right_top">
			<img alt="" src="./image/L2/L2-5.png">
		</div>
		<div id="left_bottom">
			<img alt="" src="./image/L2/L2-5.png">
		</div>
		<div id="right_bottom">
			<img alt="" src="./image/L2/L2-5.png">
		</div>
	</div>
<!-- 	右侧条 -->
	<div class="b_choose_item">
		<div id="cav1">
			<img alt="" src="./image/L2/L2-15.png">
		</div>
		<div id="cav2">
			<img alt="" src="./image/L2/L2-16.png">
		</div>
		<div id="cav3">
			<img alt="" src="./image/L2/L2-17.png">
		</div>
		<div id="cav4">
			<img alt="" src="./image/L2/L2-18.png">
		</div>
	
	</div>
	
<!-- 	正确和错误提示 -->
	<div class="b_error_or_checkmark">
		<canvas id="myCanvas"></canvas>
	</div>
	<div class="b_left_arrow">
		<img alt="" src="./image/left_arrow.png"  onclick="load_course();" />
	</div>
	<div class="b_right_arrow">
		<img alt="" src="./image/right_arrow.png"  onclick="load_disease_incidence();" >
	</div>
</div>

<script type="text/javascript">


// var c1 = document.getElementById("red_line_canvas");
// var ctx1=c1.getContext("2d");

// ctx1.beginPath(); // begin custom shape    
// ctx1.moveTo(23, 75);    
// ctx1.bezierCurveTo(23, 75, 60, 61, 78, 48);    
// ctx1.lineWidth = 3;    
// ctx1.strokeStyle = "red";    
// ctx1.stroke();


</script>

<script type="text/javascript">
function createDragAndMoveElement(element){
// 	console.log('element.id='+element.id);
	var isDown = false;
	$(element).on('mousedown',function(e){
		$(element).css('z-index',$('.b_choose_item')[0].zIndex++);
		element.last={'x':e.pageX,
					  'y':e.pageY};
		element.position=element.position||{'x':0,'y':0};
		isDown = true;
		return false;
	});
	$(element).on('mousemove',function(e){
		if(isDown){
			element.position.x=element.position.x+e.pageX-element.last.x;
			element.position.y=element.position.y+e.pageY-element.last.y;
			$(element).css('-webkit-transform','translate('+element.position.x+'px,'+element.position.y+'px)');
// 			console.log('mousemove e.pageX='+e.pageX);
// 			console.log('mousemove e.pageY='+e.pageY);
			element.last={'x':e.pageX, 'y':e.pageY};
			
		}
	});
	$(element).on('mouseup',function(e){
// 		console.log('>>end');
		isDown = false;
		var isChoose;
		
		if(element.id == 'cav1'){
			isChoose = $(".b_prostate_volume_was_larger");
			
		}
		if(element.id == 'cav2'){
			isChoose = $(".b_surgical_treatment");
		}
		if(element.id == 'cav3'){
			isChoose = $(".b_bhp_related_to_surgery");
		}
		if(element.id == 'cav4'){
			isChoose = $(".b_acute_urinary_retention");
		}
// 		console.log('!!!!!!!!!!!!!!!!!!!!'+((e.pageY-isChoose.position().top-isChoose.parent().position().top) < isChoose.height()));
// 		console.log('!!!!!!!!!!!!!!!!!!!!'+((e.pageY-isChoose.position().top-isChoose.parent().position().top) > 0));
// 		console.log('!!!!!!!!!!!!!!!!!!!!'+((e.pageX-isChoose.position().left-isChoose.parent().position().left) < isChoose.width()));
// 		console.log('!!!!!!!!!!!!!!!!!!!!'+((e.pageX-isChoose.position().left-isChoose.parent().position().left) > 0));
		if(((e.pageY-isChoose.position().top-isChoose.parent().position().top) < isChoose.height()) &&
				((e.pageY-isChoose.position().top-isChoose.parent().position().top) > 0) &&
				((e.pageX-isChoose.position().left-isChoose.parent().position().left) < isChoose.width()) &&
				((e.pageX-isChoose.position().left-isChoose.parent().position().left) > 0)){
// 			console.log('#########true');
			playCheckmark();	
// 			$(element).css('-webkit-transform','translate('+element.position.x+'px,'+element.position.y+'px)');
			var c = document.getElementById("myCanvas");
			var ctx=c.getContext("2d");
			drawCheckmarkImage(ctx);
		} else {
			playError();
			var c = document.getElementById("myCanvas");
			var ctx=c.getContext("2d");
			drawErrorImage(ctx);
			$(element).css('-webkit-transform','translate(0,0)');
			element.position={'x':0,
					  'y':0};
		}
// 		console.log('^^^^^'+e.pageX);
// 		console.log('^^^^^'+isChoose.position().left);
// 		console.log('^^^^^'+isChoose.width());
	});
	
	$(element).on('touchstart',function(e){
		$(element).css('z-index',$('.choose_item')[0].zIndex++);
		element.last={'x':e.originalEvent.touches[0].pageX,
					  'y':e.originalEvent.touches[0].pageY};
		element.position=element.position||{'x':0,'y':0};
		isDown = true;
		return false;
	});
	$(element).on('touchmove',function(e){
		if(isDown){
			element.position.x=element.position.x+e.originalEvent.touches[0].pageX-element.last.x;
			element.position.y=element.position.y+e.originalEvent.touches[0].pageY-element.last.y;
			$(element).css('-webkit-transform','translate('+element.position.x+'px,'+element.position.y+'px)');
// 			console.log('mousemove e.originalEvent.touches[0].pageX='+e.originalEvent.touches[0].pageX);
// 			console.log('mousemove e.originalEvent.touches[0].pageY='+e.originalEvent.touches[0].pageY);
			element.last={'x':e.originalEvent.touches[0].pageX, 'y':e.originalEvent.touches[0].pageY};
			
		}
	});
	$(element).on('touchend',function(e){
// 		console.log('>>end');
		isDown = false;
		var isChoose;
		
		if(element.id == 'cav1'){
			isChoose = $(".b_prostate_volume_was_larger");
			
		}
		if(element.id == 'cav2'){
			isChoose = $(".b_surgical_treatment");
		}
		if(element.id == 'cav3'){
			isChoose = $(".b_bhp_related_to_surgery");
		}
		if(element.id == 'cav4'){
			isChoose = $(".b_acute_urinary_retention");
		}
// 		console.log('!!!!!!!!!!!!!!!!!!!!'+((e.originalEvent.touches[0].pageY-isChoose.position().top-isChoose.parent().position().top) < isChoose.height()));
// 		console.log('!!!!!!!!!!!!!!!!!!!!'+((e.originalEvent.touches[0].pageY-isChoose.position().top-isChoose.parent().position().top) > 0));
// 		console.log('!!!!!!!!!!!!!!!!!!!!'+((e.originalEvent.touches[0].pageX-isChoose.position().left-isChoose.parent().position().left) < isChoose.width()));
// 		console.log('!!!!!!!!!!!!!!!!!!!!'+((e.originalEvent.touches[0].pageX-isChoose.position().left-isChoose.parent().position().left) > 0));
		if(((element.last.y-isChoose.position().top-isChoose.parent().position().top) < isChoose.height()) &&
				((element.last.y-isChoose.position().top-isChoose.parent().position().top) > 0) &&
				((element.last.x-isChoose.position().left-isChoose.parent().position().left) < isChoose.width()) &&
				((element.last.x-isChoose.position().left-isChoose.parent().position().left) > 0)){
// 			console.log('#########true');
			playCheckmark();
// 			$(element).css('-webkit-transform','translate('+element.position.x+'px,'+element.position.y+'px)');
			var c = document.getElementById("myCanvas");
			var ctx=c.getContext("2d");
			drawCheckmarkImage(ctx);
			
		} else {
			playError();
			var c = document.getElementById("myCanvas");
			var ctx=c.getContext("2d");
			drawErrorImage(ctx);
			$(element).css('-webkit-transform','translate(0,0)');
			element.position={'x':0,
					  'y':0};
		}
// 		console.log('^^^^^'+e.originalEvent.touches[0].pageX);
// 		console.log('^^^^^'+isChoose.position().left);
// 		console.log('^^^^^'+isChoose.width());
	});

	
	$(element).on('webkitTransitionEnd',function(e){
		$(element).css({
			'-webkit-transition-duration':'0'
		});
	});
	
	$(".b_prostate_volume_was_larger").mouseup(function(){
		console.log('>>end>>>>'+isDown);
      
    });
}

var elements=$('.b_choose_item').children('div');
$.each(elements,function(){
	createDragAndMoveElement(this);
});
$('.b_choose_item')[0].zIndex=1;

function playError() 
{ 
	var snd = new Audio("./mp3/error.mp3");
	snd.play();
} 
function playCheckmark() 
{ 
	var snd = new Audio("./mp3/checkmark.mp3");
	snd.play();
} 
</script>

</body>
</html>